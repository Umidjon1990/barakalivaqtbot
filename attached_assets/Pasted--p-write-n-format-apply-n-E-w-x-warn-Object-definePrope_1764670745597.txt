`);p.write(n.format.apply(n,E))}}w(x,"warn"),Object.defineProperty(e.exports,"isWin",{get:w(function(){return o},"get"),set:w(function(I){o=I},"set")}),e.exports.warnTo=function(I){var E=p;return p=I,E},e.exports.getFileName=function(I){var E=I||me.env,A=E.PGPASSFILE||(o?a.join(E.APPDATA||"./","postgresql","pgpass.conf"):a.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(I,E){return Object.prototype.hasOwnProperty.call(me.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",v(I.mode)?I.mode&(l|c)?(x('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(x('WARNING: password file "%s" is not a plain file',E),!1))};var S=e.exports.match=function(I,E){return h.slice(0,-1).reduce(function(A,O,k){return k==1&&Number(I[O]||s)===Number(E[O])?A&&!0:A&&(E[O]==="*"||E[O]===I[O])},!0)};e.exports.getPassword=function(I,E,A){var O,k=E.pipe(i());function B(Q){var R=_(Q);R&&P(R)&&S(I,R)&&(O=R[g],k.end())}w(B,"onLine");var L=w(function(){E.destroy(),A(O)},"onEnd"),W=w(function(Q){E.destroy(),x("WARNING: error on reading file: %s",Q),A(void 0)},"onErr");E.on("error",W),k.on("data",B).on("end",L).on("error",W)};var _=e.exports.parseLine=function(I){if(I.length<11||I.match(/^\s+#/))return null;for(var E="",A="",O=0,k=0,B=0,L={},W=!1,Q=w(function($,X,ie){var xe=I.substring(X,ie);Object.hasOwnProperty.call(me.env,"PGPASS_NO_DEESCAPE")||(xe=xe.replace(/\\([:\\])/g,"$1")),L[h[$]]=xe},"addToObj"),R=0;R<I.length-1;R+=1){if(E=I.charAt(R+1),A=I.charAt(R),W=O==u-1,W){Q(O,k);break}R>=0&&E==":"&&A!=="\\"&&(Q(O,k,R+1),k=R+2,O+=1)}return L=Object.keys(L).length===u?L:null,L},P=e.exports.isValidEntry=function(I){for(var E={0:function(L){return L.length>0},1:function(L){return L==="*"?!0:(L=Number(L),isFinite(L)&&L>0&&L<9007199254740992&&Math.floor(L)===L)},2:function(L){return L.length>0},3:function(L){return L.length>0},4:function(L){return L.length>0}},A=0;A<h.length;A+=1){var O=E[A],k=I[h[A]]||"",B=O(k);if(!B)return!1}return!0}}),ZB=fe((t,e)=>{"use strict";te();var a=(Vy(),kt(Z0)),r=(Qy(),kt(J0)),i=KB();e.exports=function(n,s){var o=i.getFileName();r.stat(o,function(p,l){if(p||!i.usePgPass(l,o))return s(void 0);var c=r.createReadStream(o);i.getPassword(n,c,s)})},e.exports.warnTo=i.warnTo}),X0=fe((t,e)=>{"use strict";te();var a=hd();function r(i){this._types=i||a,this.text={},this.binary={}}w(r,"TypeOverrides"),r.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},r.prototype.setTypeParser=function(i,n,s){typeof n=="function"&&(s=n,n="text"),this.getOverrides(n)[i]=s},r.prototype.getTypeParser=function(i,n){return n=n||"text",this.getOverrides(n)[i]||this._types.getTypeParser(i,n)},e.exports=r}),Zy={};za(Zy,{default:()=>Jy});var Jy,JB=sa(()=>{"use strict";te(),Jy={}}),Yy={};za(Yy,{parse:()=>eh});function eh(t,e=!1){let{protocol:a}=new URL(t),r="http:"+t.substring(a.length),{username:i,password:n,host:s,hostname:o,port:p,pathname:l,search:c,searchParams:d,hash:m}=new URL(r);n=decodeURIComponent(n),i=decodeURIComponent(i),l=decodeURIComponent(l);let v=i+":"+n,h=e?Object.fromEntries(d.entries()):c;return{href:t,protocol:a,auth:v,username:i,password:n,host:s,hostname:o,port:p,pathname:l,search:c,query:h,hash:m}}var Xy=sa(()=>{"use strict";te(),w(eh,"parse")}),YB=fe((t,e)=>{"use strict";te();var a=(Xy(),kt(Yy)),r=(Qy(),kt(J0));function i(n){if(n.charAt(0)==="/"){var o=n.split(" ");return{host:o[0],database:o[1]}}var s=a.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(n)?encodeURI(n).replace(/\%25(\d\d)/g,"%$1"):n,!0),o=s.query;for(var p in o)Array.isArray(o[p])&&(o[p]=o[p][o[p].length-1]);var l=(s.auth||":").split(":");if(o.user=l[0],o.password=l.splice(1).join(":"),o.port=s.port,s.protocol=="socket:")return o.host=decodeURI(s.pathname),o.database=s.query.db,o.client_encoding=s.query.encoding,o;o.host||(o.host=s.hostname);var c=s.pathname;if(!o.host&&c&&/^%2f/i.test(c)){var d=c.split("/");o.host=decodeURIComponent(d[0]),c=d.splice(1).join("/")}switch(c&&c.charAt(0)==="/"&&(c=c.slice(1)||null),o.database=c&&decodeURI(c),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=r.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=r.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=r.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}w(i,"parse"),e.exports=i,i.parse=i}),th=fe((t,e)=>{"use strict";te();var a=(JB(),kt(Zy)),r=vd(),i=YB().parse,n=w(function(d,m,v){return v===void 0?v=me.env["PG"+d.toUpperCase()]:v===!1||(v=me.env[v]),m[d]||v||r[d]},"val"),s=w(function(){switch(me.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return r.ssl},"readSSLConfigFromEnvironment"),o=w(function(d){return"'"+(""+d).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),p=w(function(d,m,v){var h=m[v];h!=null&&d.push(v+"="+o(h))},"add"),l=class{constructor(m){m=typeof m=="string"?i(m):m||{},m.connectionString&&(m=Object.assign({},m,i(m.connectionString))),this.user=n("user",m),this.database=n("database",m),this.database===void 0&&(this.database=this.user),this.port=parseInt(n("port",m),10),this.host=n("host",m),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:n("password",m)}),this.binary=n("binary",m),this.options=n("options",m),this.ssl=typeof m.ssl>"u"?s():m.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=n("client_encoding",m),this.replication=n("replication",m),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=n("application_name",m,"PGAPPNAME"),this.fallback_application_name=n("fallback_application_name",m,!1),this.statement_timeout=n("statement_timeout",m,!1),this.lock_timeout=n("lock_timeout",m,!1),this.idle_in_transaction_session_timeout=n("idle_in_transaction_session_timeout",m,!1),this.query_timeout=n("query_timeout",m,!1),m.connectionTimeoutMillis===void 0?this.connect_timeout=me.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(m.connectionTimeoutMillis/1e3),m.keepAlive===!1?this.keepalives=0:m.keepAlive===!0&&(this.keepalives=1),typeof m.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(m.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(m){var v=[];p(v,this,"user"),p(v,this,"password"),p(v,this,"port"),p(v,this,"application_name"),p(v,this,"fallback_application_name"),p(v,this,"connect_timeout"),p(v,this,"options");var h=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(p(v,h,"sslmode"),p(v,h,"sslca"),p(v,h,"sslkey"),p(v,h,"sslcert"),p(v,h,"sslrootcert"),this.database&&v.push("dbname="+o(this.database)),this.replication&&v.push("replication="+o(this.replication)),this.host&&v.push("host="+o(this.host)),this.isDomainSocket)return m(null,v.join(" "));this.client_encoding&&v.push("client_encoding="+o(this.client_encoding)),a.lookup(this.host,function(u,g){return u?m(u,null):(v.push("hostaddr="+o(g)),m(null,v.join(" ")))})}};w(l,"ConnectionParameters");var c=l;e.exports=c}),XB=fe((t,e)=>{"use strict";te();var a=hd(),r=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,p){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=p,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var p;o.text?p=r.exec(o.text):p=r.exec(o.command),p&&(this.command=p[1],p[3]?(this.oid=parseInt(p[2],10),this.rowCount=parseInt(p[3],10)):p[2]&&(this.rowCount=parseInt(p[2],10)))}_parseRowAsArray(o){for(var p=new Array(o.length),l=0,c=o.length;l<c;l++){var d=o[l];d!==null?p[l]=this._parsers[l](d):p[l]=null}return p}parseRow(o){for(var p={},l=0,c=o.length;l<c;l++){var d=o[l],m=this.fields[l].name;d!==null?p[m]=this._parsers[l](d):p[m]=null}return p}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var p=0;p<o.length;p++){var l=o[p];this._types?this._parsers[p]=this._types.getTypeParser(l.dataTypeID,l.format||"text"):this._parsers[p]=a.getTypeParser(l.dataTypeID,l.format||"text")}}};w(i,"Result");var n=i;e.exports=n}),eL=fe((t,e)=>{"use strict";te();var{EventEmitter:a}=mn(),r=XB(),i=gd(),n=class extends a{constructor(p,l,c){super(),p=i.normalizeQueryConfig(p,l,c),this.text=p.text,this.values=p.values,this.rows=p.rows,this.types=p.types,this.name=p.name,this.binary=p.binary,this.portal=p.portal||"",this.callback=p.callback,this._rowMode=p.rowMode,me.domain&&p.callback&&(this.callback=me.domain.bind(p.callback)),this._result=new r(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new r(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(p){this._checkForMultirow(),this._result.addFields(p.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(p){let l;if(!this._canceledDueToError){try{l=this._result.parseRow(p.fields)}catch(c){this._canceledDueToError=c;return}this.emit("row",l,this._result),this._accumulateRows&&this._result.addRow(l)}}handleCommandComplete(p,l){this._checkForMultirow(),this._result.addCommandComplete(p),this.rows&&l.sync()}handleEmptyQuery(p){this.rows&&p.sync()}handleError(p,l){if(this._canceledDueToError&&(p=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(p);this.emit("error",p)}handleReadyForQuery(p){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,p);if(this.callback)try{this.callback(null,this._results)}catch(l){me.nextTick(()=>{throw l})}this.emit("end",this._results)}submit(p){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let l=p.parsedStatements[this.name];return this.text&&l&&this.text!==l?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(p):p.query(this.text),null)}hasBeenParsed(p){return this.name&&p.parsedStatements[this.name]}handlePortalSuspended(p){this._getRows(p,this.rows)}_getRows(p,l){p.execute({portal:this.portal,rows:l}),l?p.flush():p.sync()}prepare(p){this.isPreparedStatement=!0,this.hasBeenParsed(p)||p.parse({text:this.text,name:this.name,types:this.types});try{p.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(l){this.handleError(l,p);return}p.describe({type:"P",name:this.portal||""}),this._getRows(p,this.rows)}handleCopyInResponse(p){p.sendCopyFail("No source stream defined")}handleCopyData(p,l){}};w(n,"Query");var s=n;e.exports=s}),eb={};za(eb,{Socket:()=>ci,isIP:()=>tb});function tb(t){return 0}var Py,Q0,Np,ci,ah=sa(()=>{"use strict";te(),Py=Ds(mn(),1),w(tb,"isIP"),Q0=/^[^.]+\./,Np=class re extends Py.EventEmitter{constructor(){super(...arguments),pe(this,"opts",{}),pe(this,"connecting",!1),pe(this,"pending",!0),pe(this,"writable",!0),pe(this,"encrypted",!1),pe(this,"authorized",!1),pe(this,"destroyed",!1),pe(this,"ws",null),pe(this,"writeBuffer"),pe(this,"tlsState",0),pe(this,"tlsRead"),pe(this,"tlsWrite")}static get poolQueryViaFetch(){return re.opts.poolQueryViaFetch??re.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){re.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return re.opts.fetchEndpoint??re.defaults.fetchEndpoint}static set fetchEndpoint(e){re.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return re.opts.fetchFunction??re.defaults.fetchFunction}static set fetchFunction(e){re.opts.fetchFunction=e}static get webSocketConstructor(){return re.opts.webSocketConstructor??re.defaults.webSocketConstructor}static set webSocketConstructor(e){re.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??re.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return re.opts.wsProxy??re.defaults.wsProxy}static set wsProxy(e){re.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??re.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return re.opts.coalesceWrites??re.defaults.coalesceWrites}static set coalesceWrites(e){re.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??re.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return re.opts.useSecureWebSocket??re.defaults.useSecureWebSocket}static set useSecureWebSocket(e){re.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??re.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return re.opts.forceDisablePgSSL??re.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){re.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??re.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return re.opts.disableSNI??re.defaults.disableSNI}static set disableSNI(e){re.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??re.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return re.opts.pipelineConnect??re.defaults.pipelineConnect}static set pipelineConnect(e){re.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??re.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return re.opts.subtls??re.defaults.subtls}static set subtls(e){re.opts.subtls=e}get subtls(){return this.opts.subtls??re.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return re.opts.pipelineTLS??re.defaults.pipelineTLS}static set pipelineTLS(e){re.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??re.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return re.opts.rootCerts??re.defaults.rootCerts}static set rootCerts(e){re.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??re.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,a){let r=this.wsProxy;if(r===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof r=="function"?r(e,a):`${r}?address=${e}:${a}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,a,r){this.connecting=!0,r&&this.once("connect",r);let i=w(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),n=w((o,p=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",l=>{this.emit("error",l),this.emit("close")}),o.addEventListener("message",l=>{if(this.tlsState===0){let c=se.from(l.data);this.emit("data",c)}}),o.addEventListener("close",()=>{this.emit("close")}),p?i():o.addEventListener("open",i)},"configureWebSocket"),s;try{s=this.wsProxyAddrForHost(a,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+s;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),n(this.ws);else try{this.ws=new WebSocket(o),n(this.ws)}catch{this.ws=new __unstable_WebSocket(o),n(this.ws)}}catch(o){let p=(this.useSecureWebSocket?"https:":"http:")+"//"+s;fetch(p,{headers:{Upgrade:"websocket"}}).then(l=>{if(this.ws=l.webSocket,this.ws==null)throw o;this.ws.accept(),n(this.ws,!0)}).catch(l=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${l.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let a=this.subtls.TrustedCert.fromPEM(this.rootCerts),r=new this.subtls.WebSocketReadQueue(this.ws),i=r.read.bind(r),n=this.rawWrite.bind(this),[s,o]=await this.subtls.startTls(e,a,i,n,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=s,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let a=se.from(e);this.emit("data",a)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let a=new Uint8Array(this.writeBuffer.length+e.length);a.set(this.writeBuffer),a.set(e,this.writeBuffer.length),this.writeBuffer=a}}write(e,a="utf8",r=i=>{}){return e.length===0?(r(),!0):(typeof e=="string"&&(e=se.from(e,a)),this.tlsState===0?(this.rawWrite(e),r()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,a,r)}):(this.tlsWrite(e),r()),!0)}end(e=se.alloc(0),a="utf8",r=()=>{}){return this.write(e,a,()=>{this.ws.close(),r()}),this}destroy(){return this.destroyed=!0,this.end()}},w(Np,"Socket"),pe(Np,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:w((t,e,a)=>{let r;return a?.jwtAuth?r=t.replace(Q0,"apiauth."):r=t.replace(Q0,"api."),"https://"+r+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:w(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),pe(Np,"opts",{}),ci=Np}),ab=fe(t=>{"use strict";te(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(R,$,X){super(R),this.length=$,this.name=X}};w(e,"DatabaseError");var a=e;t.DatabaseError=a;var r=class{constructor(R,$){this.length=R,this.chunk=$,this.name="copyData"}};w(r,"CopyDataMessage");var i=r;t.CopyDataMessage=i;var n=class{constructor(R,$,X,ie){this.length=R,this.name=$,this.binary=X,this.columnTypes=new Array(ie)}};w(n,"CopyResponse");var s=n;t.CopyResponse=s;var o=class{constructor(R,$,X,ie,xe,Se,Ke){this.name=R,this.tableID=$,this.columnID=X,this.dataTypeID=ie,this.dataTypeSize=xe,this.dataTypeModifier=Se,this.format=Ke}};w(o,"Field");var p=o;t.Field=p;var l=class{constructor(R,$){this.length=R,this.fieldCount=$,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};w(l,"RowDescriptionMessage");var c=l;t.RowDescriptionMessage=c;var d=class{constructor(R,$){this.length=R,this.parameterCount=$,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};w(d,"ParameterDescriptionMessage");var m=d;t.ParameterDescriptionMessage=m;var v=class{constructor(R,$,X){this.length=R,this.parameterName=$,this.parameterValue=X,this.name="parameterStatus"}};w(v,"ParameterStatusMessage");var h=v;t.ParameterStatusMessage=h;var u=class{constructor(R,$){this.length=R,this.salt=$,this.name="authenticationMD5Password"}};w(u,"AuthenticationMD5Password");var g=u;t.AuthenticationMD5Password=g;var x=class{constructor(R,$,X){this.length=R,this.processID=$,this.secretKey=X,this.name="backendKeyData"}};w(x,"BackendKeyDataMessage");var S=x;t.BackendKeyDataMessage=S;var _=class{constructor(R,$,X,ie){this.length=R,this.processId=$,this.channel=X,this.payload=ie,this.name="notification"}};w(_,"NotificationResponseMessage");var P=_;t.NotificationResponseMessage=P;var I=class{constructor(R,$){this.length=R,this.status=$,this.name="readyForQuery"}};w(I,"ReadyForQueryMessage");var E=I;t.ReadyForQueryMessage=E;var A=class{constructor(R,$){this.length=R,this.text=$,this.name="commandComplete"}};w(A,"CommandCompleteMessage");var O=A;t.CommandCompleteMessage=O;var k=class{constructor(R,$){this.length=R,this.fields=$,this.name="dataRow",this.fieldCount=$.length}};w(k,"DataRowMessage");var B=k;t.DataRowMessage=B;var L=class{constructor(R,$){this.length=R,this.message=$,this.name="notice"}};w(L,"NoticeMessage");var W=L;t.NoticeMessage=W}),tL=fe(t=>{"use strict";te(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(i)}ensure(i){var n=this.buffer.length-this.offset;if(n<i){var s=this.buffer,o=s.length+(s.length>>1)+i;this.buffer=se.allocUnsafe(o),s.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var n=se.byteLength(i);this.ensure(n+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=n}return this.buffer[this.offset++]=0,this}addString(i=""){var n=se.byteLength(i);return this.ensure(n),this.buffer.write(i,this.offset),this.offset+=n,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let n=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(n,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var n=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=se.allocUnsafe(this.size),n}};w(e,"Writer");var a=e;t.Writer=a}),aL=fe(t=>{"use strict";te(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=tL(),a=new e.Writer,r=w(R=>{a.addInt16(3).addInt16(0);for(let ie of Object.keys(R))a.addCString(ie).addCString(R[ie]);a.addCString("client_encoding").addCString("UTF8");var $=a.addCString("").flush(),X=$.length+4;return new e.Writer().addInt32(X).add($).flush()},"startup"),i=w(()=>{let R=se.allocUnsafe(8);return R.writeInt32BE(8,0),R.writeInt32BE(80877103,4),R},"requestSsl"),n=w(R=>a.addCString(R).flush(112),"password"),s=w(function(R,$){return a.addCString(R).addInt32(se.byteLength($)).addString($),a.flush(112)},"sendSASLInitialResponseMessage"),o=w(function(R){return a.addString(R).flush(112)},"sendSCRAMClientFinalMessage"),p=w(R=>a.addCString(R).flush(81),"query"),l=[],c=w(R=>{let $=R.name||"";$.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",$,$.length),console.error("This can cause conflicts and silent errors executing queries"));let X=R.types||l;for(var ie=X.length,xe=a.addCString($).addCString(R.text).addInt16(ie),Se=0;Se<ie;Se++)xe.addInt32(X[Se]);return a.flush(80)},"parse"),d=new e.Writer,m=w(function(R,$){for(let X=0;X<R.length;X++){let ie=$?$(R[X],X):R[X];ie==null?(a.addInt16(0),d.addInt32(-1)):ie instanceof se?(a.addInt16(1),d.addInt32(ie.length),d.add(ie)):(a.addInt16(0),d.addInt32(se.byteLength(ie)),d.addString(ie))}},"writeValues"),v=w((R={})=>{let $=R.portal||"",X=R.statement||"",ie=R.binary||!1,xe=R.values||l,Se=xe.length;return a.addCString($).addCString(X),a.addInt16(Se),m(xe,R.valueMapper),a.addInt16(Se),a.add(d.flush()),a.addInt16(ie?1:0),a.flush(66)},"bind"),h=se.from([69,0,0,0,9,0,0,0,0,0]),u=w(R=>{if(!R||!R.portal&&!R.rows)return h;let $=R.portal||"",X=R.rows||0,ie=se.byteLength($),xe=4+ie+1+4,Se=se.allocUnsafe(1+xe);return Se[0]=69,Se.writeInt32BE(xe,1),Se.write($,5,"utf-8"),Se[ie+5]=0,Se.writeUInt32BE(X,Se.length-4),Se},"execute"),g=w((R,$)=>{let X=se.allocUnsafe(16);return X.writeInt32BE(16,0),X.writeInt16BE(1234,4),X.writeInt16BE(5678,6),X.writeInt32BE(R,8),X.writeInt32BE($,12),X},"cancel"),x=w((R,$)=>{let X=4+se.byteLength($)+1,ie=se.allocUnsafe(1+X);return ie[0]=R,ie.writeInt32BE(X,1),ie.write($,5,"utf-8"),ie[X]=0,ie},"cstringMessage"),S=a.addCString("P").flush(68),_=a.addCString("S").flush(68),P=w(R=>R.name?x(68,`${R.type}${R.name||""}`):R.type==="P"?S:_,"describe"),I=w(R=>{let $=`${R.type}${R.name||""}`;return x(67,$)},"close"),E=w(R=>a.add(R).flush(100),"copyData"),A=w(R=>x(102,R),"copyFail"),O=w(R=>se.from([R,0,0,0,4]),"codeOnlyBuffer"),k=O(72),B=O(83),L=O(88),W=O(99),Q={startup:r,password:n,requestSsl:i,sendSASLInitialResponseMessage:s,sendSCRAMClientFinalMessage:o,query:p,parse:c,bind:v,execute:u,describe:P,close:I,flush:w(()=>k,"flush"),sync:w(()=>B,"sync"),end:w(()=>L,"end"),copyData:E,copyDone:w(()=>W,"copyDone"),copyFail:A,cancel:g};t.serialize=Q}),rL=fe(t=>{"use strict";te(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=se.allocUnsafe(0),a=class{constructor(n=0){this.offset=n,this.buffer=e,this.encoding="utf-8"}setBuffer(n,s){this.offset=n,this.buffer=s}int16(){let n=this.buffer.readInt16BE(this.offset);return this.offset+=2,n}byte(){let n=this.buffer[this.offset];return this.offset++,n}int32(){let n=this.buffer.readInt32BE(this.offset);return this.offset+=4,n}string(n){let s=this.buffer.toString(this.encoding,this.offset,this.offset+n);return this.offset+=n,s}cstring(){let n=this.offset,s=n;for(;this.buffer[s++]!==0;);return this.offset=s,this.buffer.toString(this.encoding,n,s-1)}bytes(n){let s=this.buffer.slice(this.offset,this.offset+n);return this.offset+=n,s}};w(a,"BufferReader");var r=a;t.BufferReader=r}),iL=fe(t=>{"use strict";te(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=ab(),a=rL(),r=1,i=4,n=r+i,s=se.allocUnsafe(0),o=class{constructor(c){if(this.buffer=s,this.bufferLength=0,this.bufferOffset=0,this.reader=new a.BufferReader,c?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=c?.mode||"text"}parse(c,d){this.mergeBuffer(c);let m=this.bufferOffset+this.bufferLength,v=this.bufferOffset;for(;v+n<=m;){let h=this.buffer[v],u=this.buffer.readUInt32BE(v+r),g=r+u;if(g+v<=m){let x=this.handlePacket(v+n,h,u,this.buffer);d(x),v+=g}else break}v===m?(this.buffer=s,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=m-v,this.bufferOffset=v)}mergeBuffer(c){if(this.bufferLength>0){let d=this.bufferLength+c.byteLength;if(d+this.bufferOffset>this.buffer.byteLength){let m;if(d<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)m=this.buffer;else{let v=this.buffer.byteLength*2;for(;d>=v;)v*=2;m=se.allocUnsafe(v)}this.buffer.copy(m,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=m,this.bufferOffset=0}c.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=d}else this.buffer=c,this.bufferOffset=0,this.bufferLength=c.byteLength}handlePacket(c,d,m,v){switch(d){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(c,m,v);case 67:return this.parseCommandCompleteMessage(c,m,v);case 90:return this.parseReadyForQueryMessage(c,m,v);case 65:return this.parseNotificationMessage(c,m,v);case 82:return this.parseAuthenticationResponse(c,m,v);case 83:return this.parseParameterStatusMessage(c,m,v);case 75:return this.parseBackendKeyData(c,m,v);case 69:return this.parseErrorMessage(c,m,v,"error");case 78:return this.parseErrorMessage(c,m,v,"notice");case 84:return this.parseRowDescriptionMessage(c,m,v);case 116:return this.parseParameterDescriptionMessage(c,m,v);case 71:return this.parseCopyInMessage(c,m,v);case 72:return this.parseCopyOutMessage(c,m,v);case 100:return this.parseCopyData(c,m,v);default:return new e.DatabaseError("received invalid response: "+d.toString(16),m,"error")}}parseReadyForQueryMessage(c,d,m){this.reader.setBuffer(c,m);let v=this.reader.string(1);return new e.ReadyForQueryMessage(d,v)}parseCommandCompleteMessage(c,d,m){this.reader.setBuffer(c,m);let v=this.reader.cstring();return new e.CommandCompleteMessage(d,v)}parseCopyData(c,d,m){let v=m.slice(c,c+(d-4));return new e.CopyDataMessage(d,v)}parseCopyInMessage(c,d,m){return this.parseCopyMessage(c,d,m,"copyInResponse")}parseCopyOutMessage(c,d,m){return this.parseCopyMessage(c,d,m,"copyOutResponse")}parseCopyMessage(c,d,m,v){this.reader.setBuffer(c,m);let h=this.reader.byte()!==0,u=this.reader.int16(),g=new e.CopyResponse(d,v,h,u);for(let x=0;x<u;x++)g.columnTypes[x]=this.reader.int16();return g}parseNotificationMessage(c,d,m){this.reader.setBuffer(c,m);let v=this.reader.int32(),h=this.reader.cstring(),u=this.reader.cstring();return new e.NotificationResponseMessage(d,v,h,u)}parseRowDescriptionMessage(c,d,m){this.reader.setBuffer(c,m);let v=this.reader.int16(),h=new e.RowDescriptionMessage(d,v);for(let u=0;u<v;u++)h.fields[u]=this.parseField();return h}parseField(){let c=this.reader.cstring(),d=this.reader.int32(),m=this.reader.int16(),v=this.reader.int32(),h=this.reader.int16(),u=this.reader.int32(),g=this.reader.int16()===0?"text":"binary";return new e.Field(c,d,m,v,h,u,g)}parseParameterDescriptionMessage(c,d,m){this.reader.setBuffer(c,m);let v=this.reader.int16(),h=new e.ParameterDescriptionMessage(d,v);for(let u=0;u<v;u++)h.dataTypeIDs[u]=this.reader.int32();return h}parseDataRowMessage(c,d,m){this.reader.setBuffer(c,m);let v=this.reader.int16(),h=new Array(v);for(let u=0;u<v;u++){let g=this.reader.int32();h[u]=g===-1?null:this.reader.string(g)}return new e.DataRowMessage(d,h)}parseParameterStatusMessage(c,d,m){this.reader.setBuffer(c,m);let v=this.reader.cstring(),h=this.reader.cstring();return new e.ParameterStatusMessage(d,v,h)}parseBackendKeyData(c,d,m){this.reader.setBuffer(c,m);let v=this.reader.int32(),h=this.reader.int32();return new e.BackendKeyDataMessage(d,v,h)}parseAuthenticationResponse(c,d,m){this.reader.setBuffer(c,m);let v=this.reader.int32(),h={name:"authenticationOk",length:d};switch(v){case 0:break;case 3:h.length===8&&(h.name="authenticationCleartextPassword");break;case 5:if(h.length===12){h.name="authenticationMD5Password";let g=this.reader.bytes(4);return new e.AuthenticationMD5Password(d,g)}break;case 10:h.name="authenticationSASL",h.mechanisms=[];let u;do u=this.reader.cstring(),u&&h.mechanisms.push(u);while(u);break;case 11:h.name="authenticationSASLContinue",h.data=this.reader.string(d-8);break;case 12:h.name="authenticationSASLFinal",h.data=this.reader.string(d-8);break;default:throw new Error("Unknown authenticationOk message type "+v)}return h}parseErrorMessage(c,d,m,v){this.reader.setBuffer(c,m);let h={},u=this.reader.string(1);for(;u!=="\0";)h[u]=this.reader.cstring(),u=this.reader.string(1);let g=h.M,x=v==="notice"?new e.NoticeMessage(d,g):new e.DatabaseError(g,d,v);return x.severity=h.S,x.code=h.C,x.detail=h.D,x.hint=h.H,x.position=h.P,x.internalPosition=h.p,x.internalQuery=h.q,x.where=h.W,x.schema=h.s,x.table=h.t,x.column=h.c,x.dataType=h.d,x.constraint=h.n,x.file=h.F,x.line=h.L,x.routine=h.R,x}};w(o,"Parser");var p=o;t.Parser=p}),rb=fe(t=>{"use strict";te(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=ab();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:w(function(){return e.DatabaseError},"get")});var a=aL();Object.defineProperty(t,"serialize",{enumerable:!0,get:w(function(){return a.serialize},"get")});var r=iL();function i(n,s){let o=new r.Parser;return n.on("data",p=>o.parse(p,s)),new Promise(p=>n.on("end",()=>p()))}w(i,"parse"),t.parse=i}),ib={};za(ib,{connect:()=>nb});function nb({socket:t,servername:e}){return t.startTls(e),t}var nL=sa(()=>{"use strict";te(),w(nb,"connect")}),sb=fe((t,e)=>{"use strict";te();var a=(ah(),kt(eb)),r=mn().EventEmitter,{parse:i,serialize:n}=rb(),s=n.flush(),o=n.sync(),p=n.end(),l=class extends r{constructor(m){super(),m=m||{},this.stream=m.stream||new a.Socket,this._keepAlive=m.keepAlive,this._keepAliveInitialDelayMillis=m.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=m.ssl||!1,this._ending=!1,this._emitMessage=!1;var v=this;this.on("newListener",function(h){h==="message"&&(v._emitMessage=!0)})}connect(m,v){var h=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(m,v),this.stream.once("connect",function(){h._keepAlive&&h.stream.setKeepAlive(!0,h._keepAliveInitialDelayMillis),h.emit("connect")});let u=w(function(g){h._ending&&(g.code==="ECONNRESET"||g.code==="EPIPE")||h.emit("error",g)},"reportStreamError");if(this.stream.on("error",u),this.stream.on("close",function(){h.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(g){var x=g.toString("utf8");switch(x){case"S":break;case"N":return h.stream.end(),h.emit("error",new Error("The server does not support SSL connections"));default:return h.stream.end(),h.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(nL(),kt(ib));let _={socket:h.stream};h.ssl!==!0&&(Object.assign(_,h.ssl),"key"in h.ssl&&(_.key=h.ssl.key)),a.isIP(v)===0&&(_.servername=v);try{h.stream=S.connect(_)}catch(P){return h.emit("error",P)}h.attachListeners(h.stream),h.stream.on("error",u),h.emit("sslconnect")})}attachListeners(m){m.on("end",()=>{this.emit("end")}),i(m,v=>{var h=v.name==="error"?"errorMessage":v.name;this._emitMessage&&this.emit("message",v),this.emit(h,v)})}requestSsl(){this.stream.write(n.requestSsl())}startup(m){this.stream.write(n.startup(m))}cancel(m,v){this._send(n.cancel(m,v))}password(m){this._send(n.password(m))}sendSASLInitialResponseMessage(m,v){this._send(n.sendSASLInitialResponseMessage(m,v))}sendSCRAMClientFinalMessage(m){this._send(n.sendSCRAMClientFinalMessage(m))}_send(m){return this.stream.writable?this.stream.write(m):!1}query(m){this._send(n.query(m))}parse(m){this._send(n.parse(m))}bind(m){this._send(n.bind(m))}execute(m){this._send(n.execute(m))}flush(){this.stream.writable&&this.stream.write(s)}sync(){this._ending=!0,this._send(s),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(p,()=>{this.stream.end()})}close(m){this._send(n.close(m))}describe(m){this._send(n.describe(m))}sendCopyFromChunk(m){this._send(n.copyData(m))}endCopyFrom(){this._send(n.copyDone())}sendCopyFail(m){this._send(n.copyFail(m))}};w(l,"Connection");var c=l;e.exports=c}),sL=fe((t,e)=>{"use strict";te();var a=mn().EventEmitter,r=(fd(),kt(Op)),i=gd(),n=HB(),s=ZB(),o=X0(),p=th(),l=eL(),c=vd(),d=sb(),m=class extends a{constructor(u){super(),this.connectionParameters=new p(u),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var g=u||{};this._Promise=g.Promise||md.Promise,this._types=new o(g.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=g.connection||new d({stream:g.stream,ssl:this.connectionParameters.ssl,keepAlive:g.keepAlive||!1,keepAliveInitialDelayMillis:g.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=g.binary||c.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=g.connectionTimeoutMillis||0}_errorAllQueries(u){let g=w(x=>{me.nextTick(()=>{x.handleError(u,this.connection)})},"enqueueError");this.activeQuery&&(g(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(g),this.queryQueue.length=0}_connect(u){var g=this,x=this.connection;if(this._connectionCallback=u,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");me.nextTick(()=>{u(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{x._ending=!0,x.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){g.ssl?x.requestSsl():x.startup(g.getStartupConf())}),x.on("sslconnect",function(){x.startup(g.getStartupConf())}),this._attachListeners(x),x.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),me.nextTick(()=>{this.emit("end")})})}connect(u){if(u){this._connect(u);return}return new this._Promise((g,x)=>{this._connect(S=>{S?x(S):g()})})}_attachListeners(u){u.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),u.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),u.on("authenticationSASL",this._handleAuthSASL.bind(this)),u.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),u.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),u.on("backendKeyData",this._handleBackendKeyData.bind(this)),u.on("error",this._handleErrorEvent.bind(this)),u.on("errorMessage",this._handleErrorMessage.bind(this)),u.on("readyForQuery",this._handleReadyForQuery.bind(this)),u.on("notice",this._handleNotice.bind(this)),u.on("rowDescription",this._handleRowDescription.bind(this)),u.on("dataRow",this._handleDataRow.bind(this)),u.on("portalSuspended",this._handlePortalSuspended.bind(this)),u.on("emptyQuery",this._handleEmptyQuery.bind(this)),u.on("commandComplete",this._handleCommandComplete.bind(this)),u.on("parseComplete",this._handleParseComplete.bind(this)),u.on("copyInResponse",this._handleCopyInResponse.bind(this)),u.on("copyData",this._handleCopyData.bind(this)),u.on("notification",this._handleNotification.bind(this))}_checkPgPass(u){let g=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(x=>{if(x!==void 0){if(typeof x!="string"){g.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=x}else this.connectionParameters.password=this.password=null;u()}).catch(x=>{g.emit("error",x)}):this.password!==null?u():s(this.connectionParameters,x=>{x!==void 0&&(this.connectionParameters.password=this.password=x),u()})}_handleAuthCleartextPassword(u){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(u){this._checkPgPass(()=>{let g=i.postgresMd5PasswordHash(this.user,this.password,u.salt);this.connection.password(g)})}_handleAuthSASL(u){this._checkPgPass(()=>{this.saslSession=n.startSession(u.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(u){n.continueSession(this.saslSession,this.password,u.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(u){n.finalizeSession(this.saslSession,u.data),this.saslSession=null}_handleBackendKeyData(u){this.processID=u.processID,this.secretKey=u.secretKey}_handleReadyForQuery(u){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:g}=this;this.activeQuery=null,this.readyForQuery=!0,g&&g.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(u){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(u);this.emit("error",u)}}_handleErrorEvent(u){if(this._connecting)return this._handleErrorWhileConnecting(u);this._queryable=!1,this._errorAllQueries(u),this.emit("error",u)}_handleErrorMessage(u){if(this._connecting)return this._handleErrorWhileConnecting(u);let g=this.activeQuery;if(!g){this._handleErrorEvent(u);return}this.activeQuery=null,g.handleError(u,this.connection)}_handleRowDescription(u){this.activeQuery.handleRowDescription(u)}_handleDataRow(u){this.activeQuery.handleDataRow(u)}_handlePortalSuspended(u){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(u){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(u){this.activeQuery.handleCommandComplete(u,this.connection)}_handleParseComplete(u){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(u){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(u){this.activeQuery.handleCopyData(u,this.connection)}_handleNotification(u){this.emit("notification",u)}_handleNotice(u){this.emit("notice",u)}getStartupConf(){var u=this.connectionParameters,g={user:u.user,database:u.database},x=u.application_name||u.fallback_application_name;return x&&(g.application_name=x),u.replication&&(g.replication=""+u.replication),u.statement_timeout&&(g.statement_timeout=String(parseInt(u.statement_timeout,10))),u.lock_timeout&&(g.lock_timeout=String(parseInt(u.lock_timeout,10))),u.idle_in_transaction_session_timeout&&(g.idle_in_transaction_session_timeout=String(parseInt(u.idle_in_transaction_session_timeout,10))),u.options&&(g.options=u.options),g}cancel(u,g){if(u.activeQuery===g){var x=this.connection;this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){x.cancel(u.processID,u.secretKey)})}else u.queryQueue.indexOf(g)!==-1&&u.queryQueue.splice(u.queryQueue.indexOf(g),1)}setTypeParser(u,g,x){return this._types.setTypeParser(u,g,x)}getTypeParser(u,g){return this._types.getTypeParser(u,g)}escapeIdentifier(u){return'"'+u.replace(/"/g,'""')+'"'}escapeLiteral(u){for(var g=!1,x="'",S=0;S<u.length;S++){var _=u[S];_==="'"?x+=_+_:_==="\\"?(x+=_+_,g=!0):x+=_}return x+="'",g===!0&&(x=" E"+x),x}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let u=this.activeQuery.submit(this.connection);u&&me.nextTick(()=>{this.activeQuery.handleError(u,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(u,g,x){var S,_,P,I,E;if(u==null)throw new TypeError("Client was passed a null or undefined query");return typeof u.submit=="function"?(P=u.query_timeout||this.connectionParameters.query_timeout,_=S=u,typeof g=="function"&&(S.callback=S.callback||g)):(P=this.connectionParameters.query_timeout,S=new l(u,g,x),S.callback||(_=new this._Promise((A,O)=>{S.callback=(k,B)=>k?O(k):A(B)}))),P&&(E=S.callback,I=setTimeout(()=>{var A=new Error("Query read timeout");me.nextTick(()=>{S.handleError(A,this.connection)}),E(A),S.callback=()=>{};var O=this.queryQueue.indexOf(S);O>-1&&this.queryQueue.splice(O,1),this._pulseQueryQueue()},P),S.callback=(A,O)=>{clearTimeout(I),E(A,O)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(me.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(S),this._pulseQueryQueue(),_):(me.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(u){if(this._ending=!0,!this.connection._connecting)if(u)u();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),u)this.connection.once("end",u);else return new this._Promise(g=>{this.connection.once("end",g)})}};w(m,"Client");var v=m;v.Query=l,e.exports=v}),oL=fe((t,e)=>{"use strict";te();var a=mn().EventEmitter,r=w(function(){},"NOOP"),i=w((h,u)=>{let g=h.findIndex(u);return g===-1?void 0:h.splice(g,1)[0]},"removeWhere"),n=class{constructor(u,g,x){this.client=u,this.idleListener=g,this.timeoutId=x}};w(n,"IdleItem");var s=n,o=class{constructor(u){this.callback=u}};w(o,"PendingItem");var p=o;function l(){throw new Error("Release called on client which has already been released to the pool.")}w(l,"throwOnDoubleRelease");function c(h,u){if(u)return{callback:u,result:void 0};let g,x,S=w(function(P,I){P?g(P):x(I)},"cb"),_=new h(function(P,I){x=P,g=I}).catch(P=>{throw Error.captureStackTrace(P),P});return{callback:S,result:_}}w(c,"promisify");function d(h,u){return w(function g(x){x.client=u,u.removeListener("error",g),u.on("error",()=>{h.log("additional client error after disconnection due to error",x)}),h._remove(u),h.emit("error",x,u)},"idleListener")}w(d,"makeIdleListener");var m=class extends a{constructor(u,g){super(),this.options=Object.assign({},u),u!=null&&"password"in u&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:u.password}),u!=null&&u.ssl&&u.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||g||rh().Client,this.Promise=this.options.Promise||md.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(g=>{this._remove(g.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let u=this._pendingQueue.shift();if(this._idle.length){let g=this._idle.pop();clearTimeout(g.timeoutId);let x=g.client;x.ref&&x.ref();let S=g.idleListener;return this._acquireClient(x,u,S,!1)}if(!this._isFull())return this.newClient(u);throw new Error("unexpected condition")}_remove(u){let g=i(this._idle,x=>x.client===u);g!==void 0&&clearTimeout(g.timeoutId),this._clients=this._clients.filter(x=>x!==u),u.end(),this.emit("remove",u)}connect(u){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return u?u(S):this.Promise.reject(S)}let g=c(this.Promise,u),x=g.result;if(this._isFull()||this._idle.length){if(this._idle.length&&me.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new p(g.callback)),x;let S=w((I,E,A)=>{clearTimeout(P),g.callback(I,E,A)},"queueCallback"),_=new p(S),P=setTimeout(()=>{i(this._pendingQueue,I=>I.callback===S),_.timedOut=!0,g.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),x}return this.newClient(new p(g.callback)),x}newClient(u){let g=new this.Client(this.options);this._clients.push(g);let x=d(this,g);this.log("checking client timeout");let S,_=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,g.connection?g.connection.stream.destroy():g.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),g.connect(P=>{if(S&&clearTimeout(S),g.on("error",x),P)this.log("client failed to connect",P),this._clients=this._clients.filter(I=>I!==g),_&&(P.message="Connection terminated due to connection timeout"),this._pulseQueue(),u.timedOut||u.callback(P,void 0,r);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let I=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(g),this._idle.findIndex(E=>E.client===g)!==-1&&this._acquireClient(g,new p((E,A,O)=>O()),x,!1)},this.options.maxLifetimeSeconds*1e3);I.unref(),g.once("end",()=>clearTimeout(I))}return this._acquireClient(g,u,x,!0)}})}_acquireClient(u,g,x,S){S&&this.emit("connect",u),this.emit("acquire",u),u.release=this._releaseOnce(u,x),u.removeListener("error",x),g.timedOut?S&&this.options.verify?this.options.verify(u,u.release):u.release():S&&this.options.verify?this.options.verify(u,_=>{if(_)return u.release(_),g.callback(_,void 0,r);g.callback(void 0,u,u.release)}):g.callback(void 0,u,u.release)}_releaseOnce(u,g){let x=!1;return S=>{x&&l(),x=!0,this._release(u,g,S)}}_release(u,g,x){if(u.on("error",g),u._poolUseCount=(u._poolUseCount||0)+1,this.emit("release",x,u),x||this.ending||!u._queryable||u._ending||u._poolUseCount>=this.options.maxUses){u._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(u),this._pulseQueue();return}if(this._expired.has(u)){this.log("remove expired client"),this._expired.delete(u),this._remove(u),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(u)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&u.unref(),this._idle.push(new s(u,g,S)),this._pulseQueue()}query(u,g,x){if(typeof u=="function"){let _=c(this.Promise,u);return W0(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof g=="function"&&(x=g,g=void 0);let S=c(this.Promise,x);return x=S.callback,this.connect((_,P)=>{if(_)return x(_);let I=!1,E=w(A=>{I||(I=!0,P.release(A),x(A))},"onError");P.once("error",E),this.log("dispatching query");try{P.query(u,g,(A,O)=>{if(this.log("query dispatched"),P.removeListener("error",E),!I)return I=!0,P.release(A),A?x(A):x(void 0,O)})}catch(A){return P.release(A),x(A)}}),S.result}end(u){if(this.log("ending"),this.ending){let x=new Error("Called end on pool more than once");return u?u(x):this.Promise.reject(x)}this.ending=!0;let g=c(this.Promise,u);return this._endCallback=g.callback,this._pulseQueue(),g.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((u,g)=>u+(this._expired.has(g)?1:0),0)}get totalCount(){return this._clients.length}};w(m,"Pool");var v=m;e.exports=v}),ob={};za(ob,{default:()=>pb});var pb,pL=sa(()=>{"use strict";te(),pb={}}),lL=fe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),cL=fe((t,e)=>{"use strict";te();var a=mn().EventEmitter,r=(fd(),kt(Op)),i=gd(),n=e.exports=function(o,p,l){a.call(this),o=i.normalizeQueryConfig(o,p,l),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(c){c==="row"&&(this._emitRowEvents=!0)}.bind(this))};r.inherits(n,a);var s={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};n.prototype.handleError=function(o){var p=this.native.pq.resultErrorFields();if(p)for(var l in p){var c=s[l]||l;o[c]=p[l]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},n.prototype.then=function(o,p){return this._getPromise().then(o,p)},n.prototype.catch=function(o){return this._getPromise().catch(o)},n.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,p){this._once("end",o),this._once("error",p)}.bind(this)),this._promise)},n.prototype.submit=function(o){this.state="running";var p=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var l=w(function(m,v,h){if(o.native.arrayMode=!1,W0(function(){p.emit("_done")}),m)return p.handleError(m);p._emitRowEvents&&(h.length>1?v.forEach((u,g)=>{u.forEach(x=>{p.emit("row",x,h[g])})}):v.forEach(function(u){p.emit("row",u,h)})),p.state="end",p.emit("end",h),p.callback&&p.callback(null,h)},"after");if(me.domain&&(l=me.domain.bind(l)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var c=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let m=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return l(m)}return o.native.execute(this.name,c,l)}return o.native.prepare(this.name,this.text,c.length,function(m){return m?l(m):(o.namedQueries[p.name]=p.text,p.native.execute(p.name,c,l))})}else if(this.values){if(!Array.isArray(this.values)){let m=new Error("Query values must be an array");return l(m)}var d=this.values.map(i.prepareValue);o.native.query(this.text,d,l)}else o.native.query(this.text,l)}}),dL=fe((t,e)=>{"use strict";te();var a=(pL(),kt(ob)),r=X0(),i=lL(),n=mn().EventEmitter,s=(fd(),kt(Op)),o=th(),p=cL(),l=e.exports=function(c){n.call(this),c=c||{},this._Promise=c.Promise||md.Promise,this._types=new r(c.types),this.native=new a({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var d=this.connectionParameters=new o(c);this.user=d.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:d.password}),this.database=d.database,this.host=d.host,this.port=d.port,this.namedQueries={}};l.Query=p,s.inherits(l,n),l.prototype._errorAllQueries=function(c){let d=w(m=>{me.nextTick(()=>{m.native=this.native,m.handleError(c)})},"enqueueError");this._hasActiveQuery()&&(d(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(d),this._queryQueue.length=0},l.prototype._connect=function(c){var d=this;if(this._connecting){me.nextTick(()=>c(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(m,v){if(m)return c(m);d.native.connect(v,function(h){if(h)return d.native.end(),c(h);d._connected=!0,d.native.on("error",function(u){d._queryable=!1,d._errorAllQueries(u),d.emit("error",u)}),d.native.on("notification",function(u){d.emit("notification",{channel:u.relname,payload:u.extra})}),d.emit("connect"),d._pulseQueryQueue(!0),c()})})},l.prototype.connect=function(c){if(c){this._connect(c);return}return new this._Promise((d,m)=>{this._connect(v=>{v?m(v):d()})})},l.prototype.query=function(c,d,m){var v,h,u,g,x;if(c==null)throw new TypeError("Client was passed a null or undefined query");if(typeof c.submit=="function")u=c.query_timeout||this.connectionParameters.query_timeout,h=v=c,typeof d=="function"&&(c.callback=d);else if(u=this.connectionParameters.query_timeout,v=new p(c,d,m),!v.callback){let S,_;h=new this._Promise((P,I)=>{S=P,_=I}),v.callback=(P,I)=>P?_(P):S(I)}return u&&(x=v.callback,g=setTimeout(()=>{var S=new Error("Query read timeout");me.nextTick(()=>{v.handleError(S,this.connection)}),x(S),v.callback=()=>{};var _=this._queryQueue.indexOf(v);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},u),v.callback=(S,_)=>{clearTimeout(g),x(S,_)}),this._queryable?this._ending?(v.native=this.native,me.nextTick(()=>{v.handleError(new Error("Client was closed and is not queryable"))}),h):(this._queryQueue.push(v),this._pulseQueryQueue(),h):(v.native=this.native,me.nextTick(()=>{v.handleError(new Error("Client has encountered a connection error and is not queryable"))}),h)},l.prototype.end=function(c){var d=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,c));var m;return c||(m=new this._Promise(function(v,h){c=w(u=>u?h(u):v(),"cb")})),this.native.end(function(){d._errorAllQueries(new Error("Connection terminated")),me.nextTick(()=>{d.emit("end"),c&&c()})}),m},l.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},l.prototype._pulseQueryQueue=function(c){if(this._connected&&!this._hasActiveQuery()){var d=this._queryQueue.shift();if(!d){c||this.emit("drain");return}this._activeQuery=d,d.submit(this);var m=this;d.once("_done",function(){m._pulseQueryQueue()})}},l.prototype.cancel=function(c){this._activeQuery===c?this.native.cancel(function(){}):this._queryQueue.indexOf(c)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(c),1)},l.prototype.ref=function(){},l.prototype.unref=function(){},l.prototype.setTypeParser=function(c,d,m){return this._types.setTypeParser(c,d,m)},l.prototype.getTypeParser=function(c,d){return this._types.getTypeParser(c,d)}}),Oy=fe((t,e)=>{"use strict";te(),e.exports=dL()}),rh=fe((t,e)=>{"use strict";te();var a=sL(),r=vd(),i=sb(),n=oL(),{DatabaseError:s}=rb(),o=w(l=>{var c;return c=class extends n{constructor(d){super(d,l)}},w(c,"BoundPool"),c},"poolFactory"),p=w(function(l){this.defaults=r,this.Client=l,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=hd(),this.DatabaseError=s},"PG");typeof me.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new p(Oy()):(e.exports=new p(a),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var l=null;try{l=new p(Oy())}catch(c){if(c.code!=="MODULE_NOT_FOUND")throw c}return Object.defineProperty(e.exports,"native",{value:l}),l}}))});te();var lb=Ds(rh());ah();te();ah();Xy();var uL=Ds(gd()),mL=Ds(X0());function cb(t){return t instanceof se?"\\x"+t.toString("hex"):t}w(cb,"encodeBuffersAsBytea");var db=class ub extends Error{constructor(e){super(e),pe(this,"name","NeonDbError"),pe(this,"severity"),pe(this,"code"),pe(this,"detail"),pe(this,"hint"),pe(this,"position"),pe(this,"internalPosition"),pe(this,"internalQuery"),pe(this,"where"),pe(this,"schema"),pe(this,"table"),pe(this,"column"),pe(this,"dataType"),pe(this,"constraint"),pe(this,"file"),pe(this,"line"),pe(this,"routine"),pe(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ub)}};w(db,"NeonDbError");var Ps=db,Dy="transaction() expects an array of queries, or a function returning an array of queries",fL=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function mb(t,{arrayMode:e,fullResults:a,fetchOptions:r,isolationLevel:i,readOnly:n,deferrable:s,queryCallback:o,resultCallback:p,authToken:l}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let c;try{c=eh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:d,username:m,hostname:v,port:h,pathname:u}=c;if(d!=="postgres:"&&d!=="postgresql:"||!m||!v||!u)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function g(S,..._){let P,I;if(typeof S=="string")P=S,I=_[1],_=_[0]??[];else{P="";for(let A=0;A<S.length;A++)P+=S[A],A<_.length&&(P+="$"+(A+1))}_=_.map(A=>cb((0,uL.prepareValue)(A)));let E={query:P,params:_};return o&&o(E),fb(x,E,I)}w(g,"resolve"),g.transaction=async(S,_)=>{if(typeof S=="function"&&(S=S(g)),!Array.isArray(S))throw new Error(Dy);S.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(Dy)});let P=S.map(E=>E.parameterizedQuery),I=S.map(E=>E.opts??{});return x(P,I,_)};async function x(S,_,P){let{fetchEndpoint:I,fetchFunction:E}=ci,A=Array.isArray(S)?{queries:S}:S,O=r??{},k=e??!1,B=a??!1,L=i,W=n,Q=s;P!==void 0&&(P.fetchOptions!==void 0&&(O={...O,...P.fetchOptions}),P.arrayMode!==void 0&&(k=P.arrayMode),P.fullResults!==void 0&&(B=P.fullResults),P.isolationLevel!==void 0&&(L=P.isolationLevel),P.readOnly!==void 0&&(W=P.readOnly),P.deferrable!==void 0&&(Q=P.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(O={...O,..._.fetchOptions});let R=l;!Array.isArray(_)&&_?.authToken!==void 0&&(R=_.authToken);let $=typeof I=="function"?I(v,h,{jwtAuth:R!==void 0}):I,X={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},ie=await hb(R);ie&&(X.Authorization=`Bearer ${ie}`),Array.isArray(S)&&(L!==void 0&&(X["Neon-Batch-Isolation-Level"]=L),W!==void 0&&(X["Neon-Batch-Read-Only"]=String(W)),Q!==void 0&&(X["Neon-Batch-Deferrable"]=String(Q)));let xe;try{xe=await(E??fetch)($,{method:"POST",body:JSON.stringify(A),headers:X,...O})}catch(Se){let Ke=new Ps(`Error connecting to database: ${Se.message}`);throw Ke.sourceError=Se,Ke}if(xe.ok){let Se=await xe.json();if(Array.isArray(S)){let Ke=Se.results;if(!Array.isArray(Ke))throw new Ps("Neon internal error: unexpected result format");return Ke.map((je,Ze)=>{let Ai=_[Ze]??{},mo=Ai.arrayMode??k,fo=Ai.fullResults??B;return G0(je,{arrayMode:mo,fullResults:fo,parameterizedQuery:S[Ze],resultCallback:p,types:Ai.types})})}else{let Ke=_??{},je=Ke.arrayMode??k,Ze=Ke.fullResults??B;return G0(Se,{arrayMode:je,fullResults:Ze,parameterizedQuery:S,resultCallback:p,types:Ke.types})}}else{let{status:Se}=xe;if(Se===400){let Ke=await xe.json(),je=new Ps(Ke.message);for(let Ze of fL)je[Ze]=Ke[Ze]??void 0;throw je}else{let Ke=await xe.text();throw new Ps(`Server error (HTTP status ${Se}): ${Ke}`)}}}return w(x,"execute"),g}w(mb,"neon");function fb(t,e,a){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:a,then:w((r,i)=>t(e,a).then(r,i),"then"),catch:w(r=>t(e,a).catch(r),"catch"),finally:w(r=>t(e,a).finally(r),"finally")}}w(fb,"createNeonQueryPromise");function G0(t,{arrayMode:e,fullResults:a,parameterizedQuery:r,resultCallback:i,types:n}){let s=new mL.default(n),o=t.fields.map(c=>c.name),p=t.fields.map(c=>s.getTypeParser(c.dataTypeID)),l=e===!0?t.rows.map(c=>c.map((d,m)=>d===null?null:p[m](d))):t.rows.map(c=>Object.fromEntries(c.map((d,m)=>[o[m],d===null?null:p[m](d)])));return i&&i(r,t,l,{arrayMode:e,fullResults:a}),a?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=l,t._parsers=p,t._types=s,t):l}w(G0,"processQueryResult");async function hb(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let a=new Ps("Error getting auth token.");throw e instanceof Error&&(a=new Ps(`Error getting auth token: ${e.message}`)),a}}w(hb,"getAuthToken");var hL=Ds(th()),Is=Ds(rh()),vb=class extends lb.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:a}=this;a.forceDisablePgSSL&&(thisnpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:85